!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define("potree",["three"],e):"object"==typeof exports?exports.potree=e(require("three")):t.potree=e(t.three)}(window,(function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=27)}([function(e,n){e.exports=t},function(t,e,n){"use strict";var i,o,r,a,s;n.d(e,"d",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"e",(function(){return r})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return s})),function(t){t[t.FIXED=0]="FIXED",t[t.ATTENUATED=1]="ATTENUATED",t[t.ADAPTIVE=2]="ADAPTIVE"}(i||(i={})),function(t){t[t.SQUARE=0]="SQUARE",t[t.CIRCLE=1]="CIRCLE",t[t.PARABOLOID=2]="PARABOLOID"}(o||(o={})),function(t){t[t.OCTREE=0]="OCTREE",t[t.KDTREE=1]="KDTREE"}(r||(r={})),function(t){t[t.FIXED=0]="FIXED",t[t.ATTENUATED=1]="ATTENUATED"}(a||(a={})),function(t){t[t.RGB=0]="RGB",t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.HEIGHT=3]="HEIGHT",t[t.ELEVATION=3]="ELEVATION",t[t.INTENSITY=4]="INTENSITY",t[t.INTENSITY_GRADIENT=5]="INTENSITY_GRADIENT",t[t.LOD=6]="LOD",t[t.LEVEL_OF_DETAIL=6]="LEVEL_OF_DETAIL",t[t.POINT_INDEX=7]="POINT_INDEX",t[t.CLASSIFICATION=8]="CLASSIFICATION",t[t.RETURN_NUMBER=9]="RETURN_NUMBER",t[t.SOURCE=10]="SOURCE",t[t.NORMAL=11]="NORMAL",t[t.PHONG=12]="PHONG",t[t.RGB_HEIGHT=13]="RGB_HEIGHT",t[t.COMPOSITE=50]="COMPOSITE"}(s||(s={}))},function(t,e,n){"use strict";n.d(e,"g",(function(){return o})),n.d(e,"h",(function(){return r})),n.d(e,"i",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return u})),n.d(e,"d",(function(){return l})),n.d(e,"e",(function(){return c})),n.d(e,"f",(function(){return f})),n.d(e,"j",(function(){return d})),n.d(e,"k",(function(){return p})),n.d(e,"l",(function(){return h})),n.d(e,"a",(function(){return v}));var i=n(0),o=0,r=0,a=1,s=50,u=50,l=2,c=15,f=1e6,d=2,p=4,h="PerspectiveCamera",v=new i.Color(0,0,0)},function(t,e,n){"use strict";var i;n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return s})),n.d(e,"d",(function(){return u})),function(t){t[t.POSITION_CARTESIAN=0]="POSITION_CARTESIAN",t[t.COLOR_PACKED=1]="COLOR_PACKED",t[t.COLOR_FLOATS_1=2]="COLOR_FLOATS_1",t[t.COLOR_FLOATS_255=3]="COLOR_FLOATS_255",t[t.NORMAL_FLOATS=4]="NORMAL_FLOATS",t[t.FILLER=5]="FILLER",t[t.INTENSITY=6]="INTENSITY",t[t.CLASSIFICATION=7]="CLASSIFICATION",t[t.NORMAL_SPHEREMAPPED=8]="NORMAL_SPHEREMAPPED",t[t.NORMAL_OCT16=9]="NORMAL_OCT16",t[t.NORMAL=10]="NORMAL"}(i||(i={}));var o={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,size:8}};function r(t,e,n){return{name:t,type:e,numElements:n,byteSize:n*e.size}}var a=r(i.COLOR_PACKED,o.DATA_TYPE_INT8,4),s={POSITION_CARTESIAN:r(i.POSITION_CARTESIAN,o.DATA_TYPE_FLOAT,3),RGBA_PACKED:a,COLOR_PACKED:a,RGB_PACKED:r(i.COLOR_PACKED,o.DATA_TYPE_INT8,3),NORMAL_FLOATS:r(i.NORMAL_FLOATS,o.DATA_TYPE_FLOAT,3),FILLER_1B:r(i.FILLER,o.DATA_TYPE_UINT8,1),INTENSITY:r(i.INTENSITY,o.DATA_TYPE_UINT16,1),CLASSIFICATION:r(i.CLASSIFICATION,o.DATA_TYPE_UINT8,1),NORMAL_SPHEREMAPPED:r(i.NORMAL_SPHEREMAPPED,o.DATA_TYPE_UINT8,2),NORMAL_OCT16:r(i.NORMAL_OCT16,o.DATA_TYPE_UINT8,2),NORMAL:r(i.NORMAL,o.DATA_TYPE_FLOAT,3)},u=function(){function t(t){void 0===t&&(t=[]),this.attributes=[],this.byteSize=0,this.size=0;for(var e=0;e<t.length;e++){var n=t[e],i=s[n];this.attributes.push(i),this.byteSize+=i.byteSize,this.size++}}return t.prototype.add=function(t){this.attributes.push(t),this.byteSize+=t.byteSize,this.size++},t.prototype.hasColors=function(){return void 0!==this.attributes.find(l)},t.prototype.hasNormals=function(){return void 0!==this.attributes.find(c)},t}();function l(t){return t.name===i.COLOR_PACKED}function c(t){var e=t.name;return e===i.NORMAL_SPHEREMAPPED||e===i.NORMAL_FLOATS||e===i.NORMAL||e===i.NORMAL_OCT16}},function(t,e,n){"use strict";n.r(e);var i=n(18);n.d(e,"BlurMaterial",(function(){return i.a}));var o=n(6);n.d(e,"ClipMode",(function(){return o.a}));var r=n(1);n.d(e,"PointSizeType",(function(){return r.d})),n.d(e,"PointShape",(function(){return r.c})),n.d(e,"TreeType",(function(){return r.e})),n.d(e,"PointOpacityType",(function(){return r.b})),n.d(e,"PointColorType",(function(){return r.a}));var a=n(24);n.d(e,"PointCloudMaterial",(function(){return a.a}));var s=n(5);n.d(e,"generateDataTexture",(function(){return s.b})),n.d(e,"generateGradientTexture",(function(){return s.c})),n.d(e,"generateClassificationTexture",(function(){return s.a}));var u=n(19);for(var l in u)["default","BlurMaterial","ClipMode","PointSizeType","PointShape","TreeType","PointOpacityType","PointColorType","PointCloudMaterial","generateDataTexture","generateGradientTexture","generateClassificationTexture"].indexOf(l)<0&&function(t){n.d(e,t,(function(){return u[t]}))}(l);var c=n(17);n.d(e,"GRAYSCALE",(function(){return c.a})),n.d(e,"INFERNO",(function(){return c.b})),n.d(e,"PLASMA",(function(){return c.c})),n.d(e,"RAINBOW",(function(){return c.d})),n.d(e,"SPECTRAL",(function(){return c.e})),n.d(e,"VIRIDIS",(function(){return c.f})),n.d(e,"YELLOW_GREEN",(function(){return c.g}))},function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return a}));var i=n(0);function o(t,e,n){for(var o=t*e,r=new Uint8Array(4*o),a=Math.floor(255*n.r),s=Math.floor(255*n.g),u=Math.floor(255*n.b),l=0;l<o;l++)r[3*l]=a,r[3*l+1]=s,r[3*l+2]=u;var c=new i.DataTexture(r,t,e,i.RGBAFormat);return c.needsUpdate=!0,c.magFilter=i.NearestFilter,c}function r(t){var e=document.createElement("canvas");e.width=64,e.height=64;var n=e.getContext("2d");n.rect(0,0,64,64);for(var o=n.createLinearGradient(0,0,64,64),r=0;r<t.length;r++){var a=t[r];o.addColorStop(a[0],"#"+a[1].getHexString())}n.fillStyle=o,n.fill();var s=new i.CanvasTexture(e);return s.needsUpdate=!0,s.minFilter=i.LinearFilter,s}function a(t){for(var e=new Uint8Array(262144),n=0;n<256;n++)for(var o=0;o<256;o++){var r=n+256*o,a=void 0;a=t[n]?t[n]:t[n%32]?t[n%32]:t.DEFAULT,e[4*r+0]=255*a.x,e[4*r+1]=255*a.y,e[4*r+2]=255*a.z,e[4*r+3]=255*a.w}var s=new i.DataTexture(e,256,256,i.RGBAFormat);return s.magFilter=i.NearestFilter,s.needsUpdate=!0,s}},function(t,e,n){"use strict";var i;n.d(e,"a",(function(){return i})),function(t){t[t.DISABLED=0]="DISABLED",t[t.CLIP_OUTSIDE=1]="CLIP_OUTSIDE",t[t.HIGHLIGHT_INSIDE=2]="HIGHLIGHT_INSIDE"}(i||(i={}))},function(t,e,n){"use strict";function i(t){return parseInt(t.charAt(t.length-1),10)}function o(t,e){var n=t.name,i=e.name;return n.length!==i.length?n.length-i.length:n<i?-1:n>i?1:0}n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return r}));var i=n(0);function o(t,e){return(new i.Box3).setFromPoints([new i.Vector3(t.min.x,t.min.y,t.min.z).applyMatrix4(e),new i.Vector3(t.min.x,t.min.y,t.min.z).applyMatrix4(e),new i.Vector3(t.max.x,t.min.y,t.min.z).applyMatrix4(e),new i.Vector3(t.min.x,t.max.y,t.min.z).applyMatrix4(e),new i.Vector3(t.min.x,t.min.y,t.max.z).applyMatrix4(e),new i.Vector3(t.min.x,t.max.y,t.max.z).applyMatrix4(e),new i.Vector3(t.max.x,t.max.y,t.min.z).applyMatrix4(e),new i.Vector3(t.max.x,t.min.y,t.max.z).applyMatrix4(e),new i.Vector3(t.max.x,t.max.y,t.max.z).applyMatrix4(e)])}function r(t,e){var n=t.min.clone(),o=t.max.clone(),r=(new i.Vector3).subVectors(o,n);return(1&e)>0?n.z+=r.z/2:o.z-=r.z/2,(2&e)>0?n.y+=r.y/2:o.y-=r.y/2,(4&e)>0?n.x+=r.x/2:o.x-=r.x/2,new i.Box3(n,o)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i=function(){function t(t){this.versionMinor=0,this.version=t;var e=-1===t.indexOf(".")?t.length:t.indexOf(".");this.versionMajor=parseInt(t.substr(0,e),10),this.versionMinor=parseInt(t.substr(e+1),10),isNaN(this.versionMinor)&&(this.versionMinor=0)}return t.prototype.newerThan=function(e){var n=new t(e);return this.versionMajor>n.versionMajor||this.versionMajor===n.versionMajor&&this.versionMinor>n.versionMinor},t.prototype.equalOrHigher=function(e){var n=new t(e);return this.versionMajor>n.versionMajor||this.versionMajor===n.versionMajor&&this.versionMinor>=n.versionMinor},t.prototype.upTo=function(t){return!this.newerThan(t)},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(0),o=n(2),r=n(4);function a(t,e,n){return Math.min(Math.max(e,t),n)}var s=function(){function t(){}return t.prototype.dispose=function(){this.pickState&&(this.pickState.material.dispose(),this.pickState.renderTarget.dispose())},t.prototype.pick=function(e,n,i,r,s){if(void 0===s&&(s={}),0===r.length)return null;var u=this.pickState?this.pickState:this.pickState=t.getPickState(),l=u.material,c=e.getPixelRatio(),f=Math.ceil(e.domElement.clientWidth*c),d=Math.ceil(e.domElement.clientHeight*c);t.updatePickRenderTarget(this.pickState,f,d);var p=t.helperVec3;s.pixelPosition?p.copy(s.pixelPosition):(p.addVectors(n.position,i.direction).project(n),p.x=(p.x+1)*f*.5,p.y=(p.y+1)*d*.5);var h=Math.floor((s.pickWindowSize||o.e)*c),v=(h-1)/2,m=Math.floor(a(p.x-v,0,f)),g=Math.floor(a(p.y-v,0,d));t.prepareRender(e,m,g,h,l,u);var y=t.render(e,n,l,r,i,u,s);l.clearVisibleNodeTextureOffsets();var b=t.readPixels(e,m,g,h),_=t.findHit(b,h);return t.getPickPoint(_,y)},t.prepareRender=function(t,e,n,r,a,s){t.setScissor(e,n,r,r),t.setScissorTest(!0),t.state.buffers.depth.setTest(a.depthTest),t.state.buffers.depth.setMask(a.depthWrite),t.state.setBlending(i.NoBlending),t.setRenderTarget(s.renderTarget);var u=t.getClearColor(),l=t.getClearAlpha();t.setClearColor(o.a,0),t.clear(!0,!0,!0),t.setClearColor(u,l)},t.render=function(e,n,i,o,r,a,s){for(var u=[],l=function(o){var l=t.nodesOnRay(o,r);if(!l.length)return"continue";t.updatePickMaterial(i,o.material,s),i.updateMaterial(o,l,n,e),s.onBeforePickRender&&s.onBeforePickRender(i,a.renderTarget),a.scene.children=t.createTempNodes(o,l,i,u.length),e.render(a.scene,n),l.forEach((function(t){return u.push({node:t,octree:o})}))},c=0,f=o;c<f.length;c++){l(f[c])}return u},t.nodesOnRay=function(e,n){for(var i=[],o=n.clone(),r=0,a=e.visibleNodes;r<a.length;r++){var s=a[r],u=t.helperSphere.copy(s.boundingSphere).applyMatrix4(e.matrixWorld);o.intersectsSphere(u)&&i.push(s)}return i},t.readPixels=function(t,e,n,i){var o=new Uint8Array(4*i*i);return t.readRenderTargetPixels(t.getRenderTarget(),e,n,i,i,o),t.setScissorTest(!1),t.setRenderTarget(null),o},t.createTempNodes=function(t,e,n,o){for(var a=[],s=0;s<e.length;s++){var u=e[s],l=u.sceneNode,c=new i.Points(l.geometry,n);c.matrix=l.matrix,c.matrixWorld=l.matrixWorld,c.matrixAutoUpdate=!1,c.frustumCulled=!1;var f=o+s+1;f>255&&console.error("More than 255 nodes for pick are not supported."),c.onBeforeRender=r.PointCloudMaterial.makeOnBeforeRender(t,u,f),a.push(c)}return a},t.updatePickMaterial=function(t,e,n){t.pointSizeType=e.pointSizeType,t.shape=e.shape,t.size=e.size,t.minSize=e.minSize,t.maxSize=e.maxSize,t.classification=e.classification,t.useFilterByNormal=e.useFilterByNormal,t.filterByNormalThreshold=e.filterByNormalThreshold,n.pickOutsideClipRegion?t.clipMode=r.ClipMode.DISABLED:(t.clipMode=e.clipMode,t.setClipBoxes(e.clipMode===r.ClipMode.CLIP_OUTSIDE?e.clipBoxes:[]))},t.updatePickRenderTarget=function(e,n,i){e.renderTarget.width===n&&e.renderTarget.height===i||(e.renderTarget.dispose(),e.renderTarget=t.makePickRenderTarget(),e.renderTarget.setSize(n,i))},t.makePickRenderTarget=function(){return new i.WebGLRenderTarget(1,1,{minFilter:i.LinearFilter,magFilter:i.NearestFilter,format:i.RGBAFormat})},t.findHit=function(t,e){for(var n=new Uint32Array(t.buffer),i=Number.MAX_VALUE,o=null,r=0;r<e;r++)for(var a=0;a<e;a++){var s=r+a*e,u=Math.pow(r-(e-1)/2,2)+Math.pow(a-(e-1)/2,2),l=t[4*s+3];t[4*s+3]=0;var c=n[s];l>0&&u<i&&(o={pIndex:c,pcIndex:l-1},i=u)}return o},t.getPickPoint=function(e,n){if(!e)return null;var i={},o=n[e.pcIndex]&&n[e.pcIndex].node.sceneNode;if(!o)return null;i.pointCloud=n[e.pcIndex].octree;var r=o.geometry.attributes;for(var a in r)if(r.hasOwnProperty(a)){var s=r[a];if("position"===a)t.addPositionToPickPoint(i,e,s,o);else if("normal"===a)t.addNormalToPickPoint(i,e,s,o);else if("indices"===a);else if(1===s.itemSize)i[a]=s.array[e.pIndex];else{for(var u=[],l=0;l<s.itemSize;l++)u.push(s.array[s.itemSize*e.pIndex+l]);i[a]=u}}return i},t.addPositionToPickPoint=function(t,e,n,o){t.position=(new i.Vector3).fromBufferAttribute(n,e.pIndex).applyMatrix4(o.matrixWorld)},t.addNormalToPickPoint=function(t,e,n,o){var r=(new i.Vector3).fromBufferAttribute(n,e.pIndex),a=new i.Vector4(r.x,r.y,r.z,0).applyMatrix4(o.matrixWorld);r.set(a.x,a.y,a.z),t.normal=r},t.getPickState=function(){var e=new i.Scene;e.autoUpdate=!1;var n=new r.PointCloudMaterial;return n.pointColorType=r.PointColorType.POINT_INDEX,{renderTarget:t.makePickRenderTarget(),material:n,scene:e}},t.helperVec3=new i.Vector3,t.helperSphere=new i.Sphere,t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var i,o=n(0),r=n(8),a=n(7),s=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(t){function e(n,i,r){var s=t.call(this)||this;return s.id=e.idCount++,s.level=0,s.spacing=0,s.hasChildren=!1,s.children=[null,null,null,null,null,null,null,null],s.mean=new o.Vector3,s.numPoints=0,s.loaded=!1,s.loading=!1,s.failed=!1,s.parent=null,s.oneTimeDisposeHandlers=[],s.isLeafNode=!0,s.isTreeNode=!1,s.isGeometryNode=!0,s.name=n,s.index=Object(a.b)(n),s.pcoGeometry=i,s.boundingBox=r,s.tightBoundingBox=r.clone(),s.boundingSphere=r.getBoundingSphere(new o.Sphere),s}return s(e,t),e.prototype.dispose=function(){this.geometry&&this.parent&&(this.geometry.dispose(),this.geometry=void 0,this.loaded=!1,this.oneTimeDisposeHandlers.forEach((function(t){return t()})),this.oneTimeDisposeHandlers=[])},e.prototype.getUrl=function(){var t=this.pcoGeometry,e=t.loader.version,n=[t.octreeDir];return t.loader&&e.equalOrHigher("1.5")?(n.push(this.getHierarchyBaseUrl()),n.push(this.name)):(e.equalOrHigher("1.4")||e.upTo("1.3"))&&n.push(this.name),n.join("/")},e.prototype.getHierarchyUrl=function(){return this.pcoGeometry.octreeDir+"/"+this.getHierarchyBaseUrl()+"/"+this.name+".hrc"},e.prototype.addChild=function(t){this.children[t.index]=t,this.isLeafNode=!1,t.parent=this},e.prototype.traverse=function(t,e){void 0===e&&(e=!0);for(var n,i=e?[this]:[];void 0!==(n=i.pop());){t(n);for(var o=0,r=n.children;o<r.length;o++){var a=r[o];null!==a&&i.push(a)}}},e.prototype.load=function(){var t=this;return this.canLoad()?(this.loading=!0,this.pcoGeometry.numNodesLoading++,this.pcoGeometry.needsUpdate=!0,(this.pcoGeometry.loader.version.equalOrHigher("1.5")&&this.level%this.pcoGeometry.hierarchyStepSize==0&&this.hasChildren?this.loadHierachyThenPoints():this.loadPoints()).catch((function(e){throw t.loading=!1,t.failed=!0,t.pcoGeometry.numNodesLoading--,e}))):Promise.resolve()},e.prototype.canLoad=function(){return!this.loading&&!this.loaded&&!this.pcoGeometry.disposed&&!this.pcoGeometry.loader.disposed&&this.pcoGeometry.numNodesLoading<this.pcoGeometry.maxNumNodesLoading},e.prototype.loadPoints=function(){return this.pcoGeometry.needsUpdate=!0,this.pcoGeometry.loader.load(this)},e.prototype.loadHierachyThenPoints=function(){var t=this;return this.level%this.pcoGeometry.hierarchyStepSize!=0?Promise.resolve():Promise.resolve(this.pcoGeometry.loader.getUrl(this.getHierarchyUrl())).then((function(e){return t.pcoGeometry.xhrRequest(e,{mode:"cors"})})).then((function(t){return t.arrayBuffer()})).then((function(e){return t.loadHierarchy(t,e)}))},e.prototype.getHierarchyBaseUrl=function(){for(var t=this.pcoGeometry.hierarchyStepSize,e=this.name.substr(1),n=Math.floor(e.length/t),i="r/",o=0;o<n;o++)i+=e.substr(o*t,t)+"/";return i.slice(0,-1)},e.prototype.loadHierarchy=function(t,e){var n=this,i=new DataView(e),o=this.getNodeData(t.name,0,i);t.numPoints=o.numPoints;for(var r=[o],a=[],s=5;r.length>0;)for(var u=r.shift(),l=1,c=0;c<8&&s+1<e.byteLength;c++){if(0!=(u.children&l)){var f=this.getNodeData(u.name+c,s,i);a.push(f),r.push(f),s+=5}l*=2}t.pcoGeometry.needsUpdate=!0;var d=new Map;d.set(t.name,t),a.forEach((function(e){return n.addNode(e,t.pcoGeometry,d)})),t.loadPoints()},e.prototype.getNodeData=function(t,e,n){return{children:n.getUint8(e),numPoints:n.getUint32(e+1,!0),name:t}},e.prototype.addNode=function(t,n,i){var o=t.name,s=t.numPoints,u=t.children,l=Object(a.b)(o),c=o.substring(0,o.length-1),f=i.get(c),d=o.length-1,p=new e(o,n,Object(r.b)(f.boundingBox,l));p.level=d,p.numPoints=s,p.hasChildren=u>0,p.spacing=n.spacing/Math.pow(2,d),f.addChild(p),i.set(o,p)},e.idCount=0,e}(o.EventDispatcher)},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(3),o=function(){function t(t,e,n,o,r){this.loader=t,this.boundingBox=e,this.tightBoundingBox=n,this.offset=o,this.xhrRequest=r,this.disposed=!1,this.needsUpdate=!0,this.octreeDir="",this.hierarchyStepSize=-1,this.nodes={},this.numNodesLoading=0,this.maxNumNodesLoading=3,this.spacing=0,this.pointAttributes=new i.d([]),this.projection=null,this.url=null}return t.prototype.dispose=function(){this.loader.dispose(),this.root.traverse((function(t){return t.dispose()})),this.disposed=!0},t.prototype.addNodeLoadedCallback=function(t){this.loader.callbacks.push(t)},t.prototype.clearNodeLoadedCallbacks=function(){this.loader.callbacks=[]},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i,o=n(0),r=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=function(t){function e(e,n){var i=t.call(this)||this;return i.pcIndex=void 0,i.boundingBoxNode=null,i.loaded=!0,i.isTreeNode=!0,i.isGeometryNode=!1,i.geometryNode=e,i.sceneNode=n,i.children=e.children.slice(),i}return r(e,t),e.prototype.dispose=function(){this.geometryNode.dispose()},e.prototype.disposeSceneNode=function(){var t=this.sceneNode;if(t.geometry instanceof o.BufferGeometry){var e=t.geometry.attributes;for(var n in e)"position"===n&&delete e[n].array,delete e[n];t.geometry.dispose(),t.geometry=void 0}},e.prototype.traverse=function(t,e){this.geometryNode.traverse(t,e)},Object.defineProperty(e.prototype,"id",{get:function(){return this.geometryNode.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.geometryNode.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.geometryNode.level},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLeafNode",{get:function(){return this.geometryNode.isLeafNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numPoints",{get:function(){return this.geometryNode.numPoints},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this.geometryNode.index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundingSphere",{get:function(){return this.geometryNode.boundingSphere},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundingBox",{get:function(){return this.geometryNode.boundingBox},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spacing",{get:function(){return this.geometryNode.spacing},enumerable:!1,configurable:!0}),e}(o.EventDispatcher)},function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var i,o=n(0),r=n(2),a=n(4),s=n(13),u=n(10),l=n(15),c=n(8),f=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),d=function(t){function e(e,n,i){var s=t.call(this)||this;return s.disposed=!1,s.level=0,s.maxLevel=1/0,s.minNodePixelSize=r.c,s.root=null,s.boundingBoxNodes=[],s.visibleNodes=[],s.visibleGeometry=[],s.numVisiblePoints=0,s.showBoundingBox=!1,s.visibleBounds=new o.Box3,s.name="",s.potree=e,s.root=n.root,s.pcoGeometry=n,s.boundingBox=n.boundingBox,s.boundingSphere=s.boundingBox.getBoundingSphere(new o.Sphere),s.position.copy(n.offset),s.updateMatrix(),s.material=i||new a.PointCloudMaterial,s.initMaterial(s.material),s}return f(e,t),e.prototype.initMaterial=function(t){this.updateMatrixWorld(!0);var e=Object(c.a)(this.pcoGeometry.tightBoundingBox||this.getBoundingBoxWorld(),this.matrixWorld),n=e.min,i=e.max,o=i.z-n.z;t.heightMin=n.z-.2*o,t.heightMax=i.z+.2*o},e.prototype.dispose=function(){var t=this;this.root&&this.root.dispose(),this.pcoGeometry.root.traverse((function(e){return t.potree.lru.remove(e)})),this.pcoGeometry.dispose(),this.material.dispose(),this.visibleNodes=[],this.visibleGeometry=[],this.picker&&(this.picker.dispose(),this.picker=void 0),this.disposed=!0},Object.defineProperty(e.prototype,"pointSizeType",{get:function(){return this.material.pointSizeType},set:function(t){this.material.pointSizeType=t},enumerable:!1,configurable:!0}),e.prototype.toTreeNode=function(t,e){var n=new o.Points(t.geometry,this.material),i=new s.a(t,n);return n.name=t.name,n.position.copy(t.boundingBox.min),n.frustumCulled=!1,n.onBeforeRender=a.PointCloudMaterial.makeOnBeforeRender(this,i),e?(e.sceneNode.add(n),e.children[t.index]=i,t.oneTimeDisposeHandlers.push((function(){i.disposeSceneNode(),e.sceneNode.remove(i.sceneNode),e.children[t.index]=t}))):(this.root=i,this.add(n)),i},e.prototype.updateVisibleBounds=function(){var t=this.visibleBounds;t.min.set(1/0,1/0,1/0),t.max.set(-1/0,-1/0,-1/0);for(var e=0,n=this.visibleNodes;e<n.length;e++){var i=n[e];i.isLeafNode&&(t.expandByPoint(i.boundingBox.min),t.expandByPoint(i.boundingBox.max))}},e.prototype.updateBoundingBoxes=function(){if(this.showBoundingBox&&this.parent){var t=this.parent.getObjectByName("bbroot");t||((t=new o.Object3D).name="bbroot",this.parent.add(t));for(var e=[],n=0,i=this.visibleNodes;n<i.length;n++){var r=i[n];void 0!==r.boundingBoxNode&&r.isLeafNode&&e.push(r.boundingBoxNode)}t.children=e}},e.prototype.updateMatrixWorld=function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==t||(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0)},e.prototype.hideDescendants=function(t){var e=[];for(i(t);e.length>0;){var n=e.shift();n.visible=!1,i(n)}function i(t){for(var n=0,i=t.children;n<i.length;n++){var o=i[n];o.visible&&e.push(o)}}},e.prototype.moveToOrigin=function(){this.position.set(0,0,0),this.position.set(0,0,0).sub(this.getBoundingBoxWorld().getCenter(new o.Vector3))},e.prototype.moveToGroundPlane=function(){this.position.y+=-this.getBoundingBoxWorld().min.y},e.prototype.getBoundingBoxWorld=function(){return this.updateMatrixWorld(!0),Object(c.a)(this.boundingBox,this.matrixWorld)},e.prototype.getVisibleExtent=function(){return this.visibleBounds.applyMatrix4(this.matrixWorld)},e.prototype.pick=function(t,e,n,i){return void 0===i&&(i={}),this.picker=this.picker||new u.a,this.picker.pick(t,e,n,[this],i)},Object.defineProperty(e.prototype,"progress",{get:function(){return 0===this.visibleGeometry.length?0:this.visibleNodes.length/this.visibleGeometry.length},enumerable:!1,configurable:!0}),e}(l.a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i,o=n(0),r=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.root=null,e}return r(e,t),e.prototype.initialized=function(){return null!==this.root},e}(o.Object3D)},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(0),o=n(3),r=n(9),a=function(){function t(t){var e=t.getUrl,n=void 0===e?function(t){return Promise.resolve(t)}:e,i=t.version,o=t.boundingBox,a=t.scale,s=t.xhrRequest;this.disposed=!1,this.workers=[],this.version="string"==typeof i?new r.a(i):i,this.xhrRequest=s,this.getUrl=n,this.boundingBox=o,this.scale=a,this.callbacks=[]}return t.prototype.dispose=function(){this.workers.forEach((function(t){return t.terminate()})),this.workers=[],this.disposed=!0},t.prototype.load=function(t){var e=this;return t.loaded||this.disposed?Promise.resolve():Promise.resolve(this.getUrl(this.getNodeUrl(t))).then((function(t){return e.xhrRequest(t,{mode:"cors"})})).then((function(t){return t.arrayBuffer()})).then((function(n){return new Promise((function(i){return e.parse(t,n,i)}))}))},t.prototype.getNodeUrl=function(t){var e=t.getUrl();return this.version.equalOrHigher("1.4")&&(e+=".bin"),e},t.prototype.parse=function(t,e,n){var o=this;if(this.disposed)n();else{var r=this.getWorker(),a=t.pcoGeometry.pointAttributes,s=e.byteLength/a.byteSize;this.version.upTo("1.5")&&(t.numPoints=s),r.onmessage=function(e){if(o.disposed)n();else{var a=e.data,u=t.geometry=t.geometry||new i.BufferGeometry;u.boundingBox=t.boundingBox,o.addBufferAttributes(u,a.attributeBuffers),o.addIndices(u,a.indices),o.addNormalAttribute(u,s),t.mean=(new i.Vector3).fromArray(a.mean),t.tightBoundingBox=o.getTightBoundingBox(a.tightBoundingBox),t.loaded=!0,t.loading=!1,t.failed=!1,t.pcoGeometry.numNodesLoading--,t.pcoGeometry.needsUpdate=!0,o.releaseWorker(r),o.callbacks.forEach((function(e){return e(t)})),n()}};var u={buffer:e,pointAttributes:a,version:this.version.version,min:t.boundingBox.min.toArray(),offset:t.pcoGeometry.offset.toArray(),scale:this.scale,spacing:t.spacing,hasChildren:t.hasChildren};r.postMessage(u,[u.buffer])}},t.prototype.getWorker=function(){var t=this.workers.pop();return t||new(n(32))},t.prototype.releaseWorker=function(t){this.workers.push(t)},t.prototype.getTightBoundingBox=function(t){var e=t.min,n=t.max,o=new i.Box3((new i.Vector3).fromArray(e),(new i.Vector3).fromArray(n));return o.max.sub(o.min),o.min.set(0,0,0),o},t.prototype.addBufferAttributes=function(t,e){var n=this;Object.keys(e).forEach((function(r){var a=e[r].buffer;n.isAttribute(r,o.c.POSITION_CARTESIAN)?t.setAttribute("position",new i.BufferAttribute(new Float32Array(a),3)):n.isAttribute(r,o.c.COLOR_PACKED)?t.setAttribute("color",new i.BufferAttribute(new Uint8Array(a),3,!0)):n.isAttribute(r,o.c.INTENSITY)?t.setAttribute("intensity",new i.BufferAttribute(new Float32Array(a),1)):n.isAttribute(r,o.c.CLASSIFICATION)?t.setAttribute("classification",new i.BufferAttribute(new Uint8Array(a),1)):(n.isAttribute(r,o.c.NORMAL_SPHEREMAPPED)||n.isAttribute(r,o.c.NORMAL_OCT16)||n.isAttribute(r,o.c.NORMAL))&&t.setAttribute("normal",new i.BufferAttribute(new Float32Array(a),3))}))},t.prototype.addIndices=function(t,e){var n=new i.Uint8BufferAttribute(e,4);n.normalized=!0,t.setAttribute("indices",n)},t.prototype.addNormalAttribute=function(t,e){if(!t.getAttribute("normal")){var n=new Float32Array(3*e);t.setAttribute("normal",new i.BufferAttribute(new Float32Array(n),3))}},t.prototype.isAttribute=function(t,e){return parseInt(t,10)===e},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return s})),n.d(e,"e",(function(){return u})),n.d(e,"f",(function(){return l})),n.d(e,"g",(function(){return c}));var i=n(0),o=[[0,new i.Color(0,0,0)],[1,new i.Color(1,1,1)]],r=[[0,new i.Color(.077,.042,.206)],[.1,new i.Color(.225,.036,.388)],[.2,new i.Color(.373,.074,.432)],[.3,new i.Color(.522,.128,.42)],[.4,new i.Color(.665,.182,.37)],[.5,new i.Color(.797,.255,.287)],[.6,new i.Color(.902,.364,.184)],[.7,new i.Color(.969,.516,.063)],[.8,new i.Color(.988,.683,.072)],[.9,new i.Color(.961,.859,.298)],[1,new i.Color(.988,.998,.645)]],a=[[0,new i.Color(.241,.015,.61)],[.1,new i.Color(.387,.001,.654)],[.2,new i.Color(.524,.025,.653)],[.3,new i.Color(.651,.125,.596)],[.4,new i.Color(.752,.227,.513)],[.5,new i.Color(.837,.329,.431)],[.6,new i.Color(.907,.435,.353)],[.7,new i.Color(.963,.554,.272)],[.8,new i.Color(.992,.681,.195)],[.9,new i.Color(.987,.822,.144)],[1,new i.Color(.94,.975,.131)]],s=[[0,new i.Color(.278,0,.714)],[1/6,new i.Color(0,0,1)],[2/6,new i.Color(0,1,1)],[.5,new i.Color(0,1,0)],[4/6,new i.Color(1,1,0)],[5/6,new i.Color(1,.64,0)],[1,new i.Color(1,0,0)]],u=[[0,new i.Color(.3686,.3098,.6353)],[.1,new i.Color(.1961,.5333,.7412)],[.2,new i.Color(.4,.7608,.6471)],[.3,new i.Color(.6706,.8667,.6431)],[.4,new i.Color(.902,.9608,.5961)],[.5,new i.Color(1,1,.749)],[.6,new i.Color(.9961,.8784,.5451)],[.7,new i.Color(.9922,.6824,.3804)],[.8,new i.Color(.9569,.4275,.2627)],[.9,new i.Color(.8353,.2431,.3098)],[1,new i.Color(.6196,.0039,.2588)]],l=[[0,new i.Color(.267,.005,.329)],[.1,new i.Color(.283,.141,.458)],[.2,new i.Color(.254,.265,.53)],[.3,new i.Color(.207,.372,.553)],[.4,new i.Color(.164,.471,.558)],[.5,new i.Color(.128,.567,.551)],[.6,new i.Color(.135,.659,.518)],[.7,new i.Color(.267,.749,.441)],[.8,new i.Color(.478,.821,.318)],[.9,new i.Color(.741,.873,.15)],[1,new i.Color(.993,.906,.144)]],c=[[0,new i.Color(.1647,.2824,.3451)],[.1,new i.Color(.1338,.3555,.4227)],[.2,new i.Color(.061,.4319,.4864)],[.3,new i.Color(0,.5099,.5319)],[.4,new i.Color(0,.5881,.5569)],[.5,new i.Color(.137,.665,.5614)],[.6,new i.Color(.2906,.7395,.5477)],[.7,new i.Color(.4453,.8099,.5201)],[.8,new i.Color(.6102,.8748,.485)],[.9,new i.Color(.7883,.9323,.4514)],[1,new i.Color(.9804,.9804,.4314)]]},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i,o=n(0),r=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertexShader=n(28),e.fragmentShader=n(29),e.uniforms={screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},map:{type:"t",value:null}},e}return r(e,t),e}(o.ShaderMaterial)},function(t,e){},function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var i=n(0),o=n(3),r=n(12),a=n(11),s=n(8),u=n(7),l=n(9),c=n(16);function f(t,e,n){return Promise.resolve(e(t)).then((function(t){return n(t,{mode:"cors"}).then((function(t){return t.json()})).then(function(t,e,n){return function(f){var d=function(t){var e=new i.Vector3(t.boundingBox.lx,t.boundingBox.ly,t.boundingBox.lz),n=new i.Vector3(t.boundingBox.ux,t.boundingBox.uy,t.boundingBox.uz),o=new i.Box3(e,n),r=o.clone(),a=e.clone();if(t.tightBoundingBox){var s=t.tightBoundingBox,u=s.lx,l=s.ly,c=s.lz,f=s.ux,d=s.uy,p=s.uz;r.min.set(u,l,c),r.max.set(f,d,p)}return o.min.sub(a),o.max.sub(a),r.min.sub(a),r.max.sub(a),{offset:a,boundingBox:o,tightBoundingBox:r}}(f),p=d.offset,h=d.boundingBox,v=d.tightBoundingBox,m=new c.a({getUrl:e,version:f.version,boundingBox:h,scale:f.scale,xhrRequest:n}),g=new r.a(m,h,v,p,n);g.url=t,g.octreeDir=f.octreeDir,g.needsUpdate=!0,g.spacing=f.spacing,g.hierarchyStepSize=f.hierarchyStepSize,g.projection=f.projection,g.offset=p,g.pointAttributes=new o.d(f.pointAttributes);var y={},b=new l.a(f.version);return function(t,e,n,i){var o=new a.a("r",t,t.boundingBox);o.hasChildren=!0,o.spacing=t.spacing,i.upTo("1.5")?o.numPoints=e.hierarchy[0][1]:o.numPoints=0;return t.root=o,n.r=o,t.root.load()}(g,f,y,b).then((function(){return b.upTo("1.4")&&function(t,e,n){for(var i=1;i<e.hierarchy.length;i++){var o=e.hierarchy[i],r=o[0],l=o[1],c=(m=r,{index:Object(u.b)(m),parentName:m.substring(0,m.length-1),level:m.length-1}),f=c.index,d=c.level,p=n[c.parentName],h=Object(s.b)(p.boundingBox,f),v=new a.a(r,t,h);v.level=d,v.numPoints=l,v.spacing=t.spacing/Math.pow(2,v.level),n[r]=v,p.addChild(v)}var m}(g,f,y),g.nodes=y,g}))}}(t,e,n))}))}},function(t,e){},function(t,e){},function(t,e,n){"use strict";n.d(e,"b",(function(){return x})),n.d(e,"a",(function(){return T}));var i=n(0),o=n(2),r=document.createElement("canvas").getContext("webgl"),a={SHADER_INTERPOLATION:s("EXT_frag_depth")&&u(8),SHADER_SPLATS:s("EXT_frag_depth")&&s("OES_texture_float")&&u(8),SHADER_EDL:s("OES_texture_float")&&u(8),precision:function(){if(null===r)return"";var t=r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT),e=r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT),n=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT),i=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT),o=t&&n&&t.precision>0&&n.precision>0,a=e&&i&&e.precision>0&&i.precision>0;return o?"highp":a?"mediump":"lowp"}()};function s(t){return null!==r&&Boolean(r.getExtension(t))}function u(t){return null!==r&&r.getParameter(r.MAX_VARYING_VECTORS)>=t}var l=n(25),c=n(4),f=n(14),d=n(10);function p(t){return null!=t&&t.isGeometryNode}function h(t){return null!=t&&t.isTreeNode}var v,m=n(26),g=(v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),y=function(t){function e(e,n){void 0===n&&(n=new i.Color(16776960));var o=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array([e.min.x,e.min.y,e.min.z,e.max.x,e.min.y,e.min.z,e.max.x,e.min.y,e.max.z,e.min.x,e.min.y,e.max.z,e.min.x,e.max.y,e.min.z,e.max.x,e.max.y,e.min.z,e.max.x,e.max.y,e.max.z,e.min.x,e.max.y,e.max.z]),a=new i.BufferGeometry;a.setIndex(new i.BufferAttribute(o,1)),a.setAttribute("position",new i.BufferAttribute(r,3));var s=new i.LineBasicMaterial({color:n});return t.call(this,a,s)||this}return g(e,t),e}(i.LineSegments),b=function(t){this.node=t,this.next=null,this.previous=null},_=function(){function t(t){void 0===t&&(t=1e6),this.pointBudget=t,this.first=null,this.last=null,this.numPoints=0,this.items=new Map}return Object.defineProperty(t.prototype,"size",{get:function(){return this.items.size},enumerable:!1,configurable:!0}),t.prototype.has=function(t){return this.items.has(t.id)},t.prototype.touch=function(t){if(t.loaded){var e=this.items.get(t.id);e?this.touchExisting(e):this.addNew(t)}},t.prototype.addNew=function(t){var e=new b(t);e.previous=this.last,this.last=e,e.previous&&(e.previous.next=e),this.first||(this.first=e),this.items.set(t.id,e),this.numPoints+=t.numPoints},t.prototype.touchExisting=function(t){t.previous?t.next&&(t.previous.next=t.next,t.next.previous=t.previous,t.previous=this.last,t.next=null,this.last=t,t.previous&&(t.previous.next=t)):t.next&&(this.first=t.next,this.first.previous=null,t.previous=this.last,t.next=null,this.last=t,t.previous&&(t.previous.next=t))},t.prototype.remove=function(t){var e=this.items.get(t.id);e&&(1===this.items.size?(this.first=null,this.last=null):(e.previous||(this.first=e.next,this.first.previous=null),e.next||(this.last=e.previous,this.last.next=null),e.previous&&e.next&&(e.previous.next=e.next,e.next.previous=e.previous)),this.items.delete(t.id),this.numPoints-=t.numPoints)},t.prototype.getLRUItem=function(){return this.first?this.first.node:void 0},t.prototype.freeMemory=function(){if(!(this.items.size<=1))for(;this.numPoints>2*this.pointBudget;){var t=this.getLRUItem();t&&this.disposeSubtree(t)}},t.prototype.disposeSubtree=function(t){var e=[t];t.traverse((function(t){t.loaded&&e.push(t)}));for(var n=0,i=e;n<i.length;n++){var o=i[n];o.dispose(),this.remove(o)}},t}(),x=function(t,e,n,i){this.pointCloudIndex=t,this.weight=e,this.node=n,this.parent=i},T=function(){function t(){var t,e,n;this._pointBudget=o.f,this._rendererSize=new i.Vector2,this.maxNumNodesLoading=o.k,this.features=a,this.lru=new _(this._pointBudget),this.updateVisibilityStructures=(t=new i.Matrix4,e=new i.Matrix4,n=new i.Matrix4,function(o,r){for(var a=[],s=[],u=new m.BinaryHeap((function(t){return 1/t.weight})),l=0;l<o.length;l++){var c=o[l];if(c.initialized()){c.numVisiblePoints=0,c.visibleNodes=[],c.visibleGeometry=[],r.updateMatrixWorld(!1);var f=r.matrixWorldInverse,d=c.matrixWorld;if(t.identity().multiply(r.projectionMatrix).multiply(f).multiply(d),a.push((new i.Frustum).setFromProjectionMatrix(t)),e.getInverse(d),n.identity().multiply(e).multiply(r.matrixWorld),s.push((new i.Vector3).setFromMatrixPosition(n)),c.visible&&null!==c.root){var p=Number.MAX_VALUE;u.push(new x(l,p,c.root))}h(c.root)&&c.hideDescendants(c.root.sceneNode);for(var v=0,g=c.boundingBoxNodes;v<g.length;v++)g[v].visible=!1}}return{frustums:a,cameraPositions:s,priorityQueue:u}})}return t.prototype.loadPointCloud=function(t,e,n){var i=this;return void 0===n&&(n=function(t,e){return fetch(t,e)}),Object(l.loadPOC)(t,e,n).then((function(t){return new f.a(i,t)}))},t.prototype.updatePointClouds=function(t,e,n){for(var i=this.updateVisibility(t,e,n),o=0;o<t.length;o++){var r=t[o];r.disposed||(r.material.updateMaterial(r,r.visibleNodes,e,n),r.updateVisibleBounds(),r.updateBoundingBoxes())}return this.lru.freeMemory(),i},t.pick=function(e,n,i,o,r){return void 0===r&&(r={}),t.picker=t.picker||new d.a,t.picker.pick(n,i,o,e,r)},Object.defineProperty(t.prototype,"pointBudget",{get:function(){return this._pointBudget},set:function(t){t!==this._pointBudget&&(this._pointBudget=t,this.lru.pointBudget=t,this.lru.freeMemory())},enumerable:!1,configurable:!0}),t.prototype.updateVisibility=function(t,e,n){for(var i,r=0,a=[],s=[],u=this.updateVisibilityStructures(t,e),l=u.frustums,c=u.cameraPositions,f=u.priorityQueue,d=0,v=!1,m=!1;void 0!==(i=f.pop());){var g=i.node;if(r+g.numPoints>this.pointBudget)break;var y=i.pointCloudIndex,b=t[y],_=void 0!==b.maxLevel?b.maxLevel:1/0;if(!(g.level>_||!l[y].intersectsBox(g.boundingBox)||this.shouldClip(b,g.boundingBox))){r+=g.numPoints,b.numVisiblePoints+=g.numPoints;var x=i.parent;if(p(g)&&(!x||h(x)))if(g.loaded&&d<o.j)g=b.toTreeNode(g,x),d++;else{if(g.failed){m=!0;continue}g.loaded&&d>=o.j&&(v=!0),s.push(g),b.visibleGeometry.push(g)}h(g)&&(this.updateTreeNodeVisibility(b,g,a),b.visibleGeometry.push(g.geometryNode));var T=.5*n.getSize(this._rendererSize).height*n.getPixelRatio();this.updateChildVisibility(i,f,b,g,c[y],e,T)}}for(var A=Math.min(this.maxNumNodesLoading,s.length),O=[],w=0;w<A;w++)O.push(s[w].load());return{visibleNodes:a,numVisiblePoints:r,exceededMaxLoadsToGPU:v,nodeLoadFailed:m,nodeLoadPromises:O}},t.prototype.updateTreeNodeVisibility=function(t,e,n){this.lru.touch(e.geometryNode);var i=e.sceneNode;i.visible=!0,i.material=t.material,i.updateMatrix(),i.matrixWorld.multiplyMatrices(t.matrixWorld,i.matrix),n.push(e),t.visibleNodes.push(e),this.updateBoundingBoxVisibility(t,e)},t.prototype.updateChildVisibility=function(t,e,n,i,r,a,s){for(var u=i.children,l=0;l<u.length;l++){var c=u[l];if(null!==c){var f=c.boundingSphere,d=f.center.distanceTo(r),p=f.radius,h=0;if(a.type===o.l){var v=a.fov*Math.PI/180;h=s/(Math.tan(v/2)*d)}else{var m=a;h=2*s/(m.top-m.bottom)}var g=p*h;if(!(g<n.minNodePixelSize)){var y=d<p?Number.MAX_VALUE:g+1/d;e.push(new x(t.pointCloudIndex,y,c,i))}}}},t.prototype.updateBoundingBoxVisibility=function(t,e){if(t.showBoundingBox&&!e.boundingBoxNode){var n=new y(e.boundingBox);n.matrixAutoUpdate=!1,t.boundingBoxNodes.push(n),e.boundingBoxNode=n,e.boundingBoxNode.matrix.copy(t.matrixWorld)}else t.showBoundingBox&&e.boundingBoxNode?(e.boundingBoxNode.visible=!0,e.boundingBoxNode.matrix.copy(t.matrixWorld)):!t.showBoundingBox&&e.boundingBoxNode&&(e.boundingBoxNode.visible=!1)},t.prototype.shouldClip=function(t,e){var n=t.material;if(0===n.numClipBoxes||n.clipMode!==c.ClipMode.CLIP_OUTSIDE)return!1;var o=e.clone();t.updateMatrixWorld(!0),o.applyMatrix4(t.matrixWorld);for(var r=n.clipBoxes,a=0;a<r.length;a++){var s=r[a].matrix,u=new i.Box3(new i.Vector3(-.5,-.5,-.5),new i.Vector3(.5,.5,.5)).applyMatrix4(s);if(o.intersectsBox(u))return!1}return!0},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return N}));var i,o,r,a,s,u,l,c=n(0),f=n(2),d=n(7),p={0:new c.Vector4(.5,.5,.5,1),1:new c.Vector4(.5,.5,.5,1),2:new c.Vector4(.63,.32,.18,1),3:new c.Vector4(0,1,0,1),4:new c.Vector4(0,.8,0,1),5:new c.Vector4(0,.6,0,1),6:new c.Vector4(1,.66,0,1),7:new c.Vector4(1,0,1,1),8:new c.Vector4(1,0,0,1),9:new c.Vector4(0,0,1,1),12:new c.Vector4(1,1,0,1),DEFAULT:new c.Vector4(.3,.6,.6,.5)},h=n(6),v=n(1),m=n(17),g=n(5),y=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),b=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},_=((o={})[v.e.OCTREE]="tree_type_octree",o[v.e.KDTREE]="tree_type_kdtree",o),x=((r={})[v.d.FIXED]="fixed_point_size",r[v.d.ATTENUATED]="attenuated_point_size",r[v.d.ADAPTIVE]="adaptive_point_size",r),T=((a={})[v.b.ATTENUATED]="attenuated_opacity",a[v.b.FIXED]="fixed_opacity",a),A=((s={})[v.c.SQUARE]="square_point_shape",s[v.c.CIRCLE]="circle_point_shape",s[v.c.PARABOLOID]="paraboloid_point_shape",s),O=((u={})[v.a.RGB]="color_type_rgb",u[v.a.COLOR]="color_type_color",u[v.a.DEPTH]="color_type_depth",u[v.a.HEIGHT]="color_type_height",u[v.a.INTENSITY]="color_type_intensity",u[v.a.INTENSITY_GRADIENT]="color_type_intensity_gradient",u[v.a.LOD]="color_type_lod",u[v.a.POINT_INDEX]="color_type_point_index",u[v.a.CLASSIFICATION]="color_type_classification",u[v.a.RETURN_NUMBER]="color_type_return_number",u[v.a.SOURCE]="color_type_source",u[v.a.NORMAL]="color_type_normal",u[v.a.PHONG]="color_type_phong",u[v.a.RGB_HEIGHT]="color_type_rgb_height",u[v.a.COMPOSITE]="color_type_composite",u),w=((l={})[h.a.DISABLED]="clip_disabled",l[h.a.CLIP_OUTSIDE]="clip_outside",l[h.a.HIGHLIGHT_INSIDE]="clip_highlight_inside",l),N=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;n.lights=!1,n.fog=!1,n.numClipBoxes=0,n.clipBoxes=[],n.visibleNodeTextureOffsets=new Map,n._gradient=m.e,n.gradientTexture=Object(g.c)(n._gradient),n._classification=p,n.classificationTexture=Object(g.a)(n._classification),n.uniforms={bbSize:S("fv",[0,0,0]),blendDepthSupplement:S("f",0),blendHardness:S("f",2),classificationLUT:S("t",n.classificationTexture||new c.Texture),clipBoxCount:S("f",0),clipBoxes:S("Matrix4fv",[]),depthMap:S("t",null),diffuse:S("fv",[1,1,1]),fov:S("f",1),gradient:S("t",n.gradientTexture||new c.Texture),heightMax:S("f",1),heightMin:S("f",0),intensityBrightness:S("f",0),intensityContrast:S("f",0),intensityGamma:S("f",1),intensityRange:S("fv",[0,65e3]),isLeafNode:S("b",0),level:S("f",0),maxSize:S("f",f.b),minSize:S("f",f.d),octreeSize:S("f",0),opacity:S("f",1),pcIndex:S("f",0),rgbBrightness:S("f",f.g),rgbContrast:S("f",f.h),rgbGamma:S("f",f.i),screenHeight:S("f",1),screenWidth:S("f",1),size:S("f",1),spacing:S("f",1),toModel:S("Matrix4f",[]),transition:S("f",.5),uColor:S("c",new c.Color(16777215)),visibleNodes:S("t",n.visibleNodesTexture||new c.Texture),vnStart:S("f",0),wClassification:S("f",0),wElevation:S("f",0),wIntensity:S("f",0),wReturnNumber:S("f",0),wRGB:S("f",1),wSourceID:S("f",0),opacityAttenuation:S("f",1),filterByNormalThreshold:S("f",0)},n.useClipBox=!1,n.weighted=!1,n.pointColorType=v.a.RGB,n.pointSizeType=v.d.ADAPTIVE,n.clipMode=h.a.DISABLED,n.useEDL=!1,n.shape=v.c.SQUARE,n.treeType=v.e.OCTREE,n.pointOpacityType=v.b.FIXED,n.useFilterByNormal=!1,n.attributes={position:{type:"fv",value:[]},color:{type:"fv",value:[]},normal:{type:"fv",value:[]},intensity:{type:"f",value:[]},classification:{type:"f",value:[]},returnNumber:{type:"f",value:[]},numberOfReturns:{type:"f",value:[]},pointSourceID:{type:"f",value:[]},indices:{type:"fv",value:[]}};var i=n.visibleNodesTexture=Object(g.b)(2048,1,new c.Color(16777215));return i.minFilter=c.NearestFilter,i.magFilter=c.NearestFilter,n.setUniform("visibleNodes",i),n.treeType=P(e.treeType,v.e.OCTREE),n.size=P(e.size,1),n.minSize=P(e.minSize,2),n.maxSize=P(e.maxSize,50),n.classification=p,n.defaultAttributeValues.normal=[0,0,0],n.defaultAttributeValues.classification=[0,0,0],n.defaultAttributeValues.indices=[0,0,0,0],n.vertexColors=!0,n.updateShaderSource(),n}return y(e,t),e.prototype.dispose=function(){t.prototype.dispose.call(this),this.gradientTexture&&(this.gradientTexture.dispose(),this.gradientTexture=void 0),this.visibleNodesTexture&&(this.visibleNodesTexture.dispose(),this.visibleNodesTexture=void 0),this.clearVisibleNodeTextureOffsets(),this.classificationTexture&&(this.classificationTexture.dispose(),this.classificationTexture=void 0),this.depthMap&&(this.depthMap.dispose(),this.depthMap=void 0)},e.prototype.clearVisibleNodeTextureOffsets=function(){this.visibleNodeTextureOffsets.clear()},e.prototype.updateShaderSource=function(){this.vertexShader=this.applyDefines(n(30).default),this.fragmentShader=this.applyDefines(n(31).default),1===this.opacity?(this.blending=c.NoBlending,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.depthFunc=c.LessEqualDepth):this.opacity<1&&!this.useEDL&&(this.blending=c.AdditiveBlending,this.transparent=!0,this.depthTest=!1,this.depthWrite=!0),this.weighted&&(this.blending=c.AdditiveBlending,this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.depthFunc=c.LessEqualDepth),this.needsUpdate=!0},e.prototype.applyDefines=function(t){var e=[];function n(t){t&&e.push("#define "+t)}return n(_[this.treeType]),n(x[this.pointSizeType]),n(A[this.shape]),n(O[this.pointColorType]),n(w[this.clipMode]),n(T[this.pointOpacityType]),this.rgbGamma===f.i&&this.rgbBrightness===f.g&&this.rgbContrast===f.h||n("use_rgb_gamma_contrast_brightness"),this.useFilterByNormal&&n("use_filter_by_normal"),this.useEDL&&n("use_edl"),this.weighted&&n("weighted_splats"),this.numClipBoxes>0&&n("use_clip_box"),n("MAX_POINT_LIGHTS 0"),n("MAX_DIR_LIGHTS 0"),e.push(t),e.join("\n")},e.prototype.setClipBoxes=function(t){if(t){this.clipBoxes=t;var e=this.numClipBoxes!==t.length&&(0===t.length||0===this.numClipBoxes);this.numClipBoxes=t.length,this.setUniform("clipBoxCount",this.numClipBoxes),e&&this.updateShaderSource();for(var n=16*this.numClipBoxes,i=new Float32Array(n),o=0;o<this.numClipBoxes;o++)i.set(t[o].inverse.elements,16*o);for(o=0;o<n;o++)isNaN(i[o])&&(i[o]=1/0);this.setUniform("clipBoxes",i)}},Object.defineProperty(e.prototype,"gradient",{get:function(){return this._gradient},set:function(t){this._gradient!==t&&(this._gradient=t,this.gradientTexture=Object(g.c)(this._gradient),this.setUniform("gradient",this.gradientTexture))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"classification",{get:function(){return this._classification},set:function(t){for(var e={},n=0,i=Object.keys(t);n<i.length;n++){e[s=i[n]]=t[s].clone()}var o=!1;if(void 0===this._classification)o=!1;else{o=Object.keys(e).length===Object.keys(this._classification).length;for(var r=0,a=Object.keys(e);r<a.length;r++){var s=a[r];o=(o=o&&void 0!==this._classification[s])&&e[s].equals(this._classification[s])}}o||(this._classification=e,this.recomputeClassification())},enumerable:!1,configurable:!0}),e.prototype.recomputeClassification=function(){this.classificationTexture=Object(g.a)(this._classification),this.setUniform("classificationLUT",this.classificationTexture)},Object.defineProperty(e.prototype,"elevationRange",{get:function(){return[this.heightMin,this.heightMax]},set:function(t){this.heightMin=t[0],this.heightMax=t[1]},enumerable:!1,configurable:!0}),e.prototype.getUniform=function(t){return void 0===this.uniforms?void 0:this.uniforms[t].value},e.prototype.setUniform=function(t,e){if(void 0!==this.uniforms){var n=this.uniforms[t];"c"===n.type?n.value.copy(e):e!==n.value&&(n.value=e)}},e.prototype.updateMaterial=function(t,n,i,o){var r=o.getPixelRatio();i.type===f.l?this.fov=i.fov*(Math.PI/180):this.fov=Math.PI/2,this.screenWidth=o.domElement.clientWidth*r,this.screenHeight=o.domElement.clientHeight*r;var a=Math.max(t.scale.x,t.scale.y,t.scale.z);this.spacing=t.pcoGeometry.spacing*a,this.octreeSize=t.pcoGeometry.boundingBox.getSize(e.helperVec3).x,this.pointSizeType!==v.d.ADAPTIVE&&this.pointColorType!==v.a.LOD||this.updateVisibilityTextureData(n)},e.prototype.updateVisibilityTextureData=function(t){t.sort(d.a);var e=new Uint8Array(4*t.length),n=new Array(t.length).fill(1/0);this.visibleNodeTextureOffsets.clear();for(var i=0;i<t.length;i++){var o=t[i];if(this.visibleNodeTextureOffsets.set(o.name,i),i>0){var r=o.name.slice(0,-1),a=this.visibleNodeTextureOffsets.get(r),s=i-a;n[a]=Math.min(n[a],s);var u=4*a;e[u]=e[u]|1<<o.index,e[u+1]=n[a]>>8,e[u+2]=n[a]%256}e[4*i+3]=o.name.length}var l=this.visibleNodesTexture;l&&(l.image.data.set(e),l.needsUpdate=!0)},e.makeOnBeforeRender=function(t,e,n){return function(i,o,r,a,s){var u=s,l=u.uniforms;l.level.value=e.level,l.isLeafNode.value=e.isLeafNode;var c=u.visibleNodeTextureOffsets.get(e.name);void 0!==c&&(l.vnStart.value=c),l.pcIndex.value=void 0!==n?n:t.visibleNodes.indexOf(e),s.uniformsNeedUpdate=!0}},e.helperVec3=new c.Vector3,b([C("bbSize")],e.prototype,"bbSize",void 0),b([C("depthMap")],e.prototype,"depthMap",void 0),b([C("fov")],e.prototype,"fov",void 0),b([C("heightMax")],e.prototype,"heightMax",void 0),b([C("heightMin")],e.prototype,"heightMin",void 0),b([C("intensityBrightness")],e.prototype,"intensityBrightness",void 0),b([C("intensityContrast")],e.prototype,"intensityContrast",void 0),b([C("intensityGamma")],e.prototype,"intensityGamma",void 0),b([C("intensityRange")],e.prototype,"intensityRange",void 0),b([C("maxSize")],e.prototype,"maxSize",void 0),b([C("minSize")],e.prototype,"minSize",void 0),b([C("octreeSize")],e.prototype,"octreeSize",void 0),b([C("opacity",!0)],e.prototype,"opacity",void 0),b([C("rgbBrightness",!0)],e.prototype,"rgbBrightness",void 0),b([C("rgbContrast",!0)],e.prototype,"rgbContrast",void 0),b([C("rgbGamma",!0)],e.prototype,"rgbGamma",void 0),b([C("screenHeight")],e.prototype,"screenHeight",void 0),b([C("screenWidth")],e.prototype,"screenWidth",void 0),b([C("size")],e.prototype,"size",void 0),b([C("spacing")],e.prototype,"spacing",void 0),b([C("transition")],e.prototype,"transition",void 0),b([C("uColor")],e.prototype,"color",void 0),b([C("wClassification")],e.prototype,"weightClassification",void 0),b([C("wElevation")],e.prototype,"weightElevation",void 0),b([C("wIntensity")],e.prototype,"weightIntensity",void 0),b([C("wReturnNumber")],e.prototype,"weightReturnNumber",void 0),b([C("wRGB")],e.prototype,"weightRGB",void 0),b([C("wSourceID")],e.prototype,"weightSourceID",void 0),b([C("opacityAttenuation")],e.prototype,"opacityAttenuation",void 0),b([C("filterByNormalThreshold")],e.prototype,"filterByNormalThreshold",void 0),b([I()],e.prototype,"useClipBox",void 0),b([I()],e.prototype,"weighted",void 0),b([I()],e.prototype,"pointColorType",void 0),b([I()],e.prototype,"pointSizeType",void 0),b([I()],e.prototype,"clipMode",void 0),b([I()],e.prototype,"useEDL",void 0),b([I()],e.prototype,"shape",void 0),b([I()],e.prototype,"treeType",void 0),b([I()],e.prototype,"pointOpacityType",void 0),b([I()],e.prototype,"useFilterByNormal",void 0),e}(c.RawShaderMaterial);function S(t,e){return{type:t,value:e}}function P(t,e){return void 0===t?e:t}function C(t,e){return void 0===e&&(e=!1),function(n,i){Object.defineProperty(n,i,{get:function(){return this.getUniform(t)},set:function(n){n!==this.getUniform(t)&&(this.setUniform(t,n),e&&this.updateShaderSource())}})}}function I(){return function(t,e){var n="_"+e.toString();Object.defineProperty(t,e,{get:function(){return this[n]},set:function(t){t!==this[n]&&(this[n]=t,this.updateShaderSource())}})}}},function(t,e,n){"use strict";n(16);var i=n(20);n.d(e,"loadPOC",(function(){return i.a}));n(21)},function(t,e,n){"use strict";function i(t){this.content=[],this.scoreFunction=t}Object.defineProperty(e,"__esModule",{value:!0}),e.BinaryHeap=i,i.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},remove:function(t){for(var e=this.content.length,n=0;n<e;n++)if(this.content[n]==t){var i=this.content.pop();if(n==e-1)break;this.content[n]=i,this.bubbleUp(n),this.sinkDown(n);break}},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t],n=this.scoreFunction(e);t>0;){var i=Math.floor((t+1)/2)-1,o=this.content[i];if(n>=this.scoreFunction(o))break;this.content[i]=e,this.content[t]=o,t=i}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],i=this.scoreFunction(n);;){var o=2*(t+1),r=o-1,a=null;if(r<e){var s=this.content[r],u=this.scoreFunction(s);u<i&&(a=r)}if(o<e){var l=this.content[o];this.scoreFunction(l)<(null==a?i:u)&&(a=o)}if(null==a)break;this.content[t]=this.content[a],this.content[a]=n,t=a}}}},function(t,e,n){"use strict";n.r(e);var i=n(4);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);var r=n(3);n.d(e,"PointAttributeName",(function(){return r.c})),n.d(e,"POINT_ATTRIBUTE_TYPES",(function(){return r.b})),n.d(e,"POINT_ATTRIBUTES",(function(){return r.a})),n.d(e,"PointAttributes",(function(){return r.d}));var a=n(11);n.d(e,"PointCloudOctreeGeometryNode",(function(){return a.a}));var s=n(12);n.d(e,"PointCloudOctreeGeometry",(function(){return s.a}));var u=n(13);n.d(e,"PointCloudOctreeNode",(function(){return u.a}));var l=n(10);n.d(e,"PointCloudOctreePicker",(function(){return l.a}));var c=n(14);n.d(e,"PointCloudOctree",(function(){return c.a}));var f=n(15);n.d(e,"PointCloudTree",(function(){return f.a}));var d=n(23);n.d(e,"QueueItem",(function(){return d.b})),n.d(e,"Potree",(function(){return d.a}));var p=n(22);for(var o in p)["default","PointAttributeName","POINT_ATTRIBUTE_TYPES","POINT_ATTRIBUTES","PointAttributes","PointCloudOctreeGeometryNode","PointCloudOctreeGeometry","PointCloudOctreeNode","PointCloudOctreePicker","PointCloudOctree","PointCloudTree","QueueItem","Potree"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return p[t]}))}(o);var h=n(9);n.d(e,"Version",(function(){return h.a}))},function(t,e,n){"use strict";n.r(e),e.default="precision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},function(t,e,n){"use strict";n.r(e),e.default="precision highp float;\nprecision highp int;\n\nuniform mat4 projectionMatrix;\n\nuniform float screenWidth;\nuniform float screenHeight;\n\nuniform sampler2D map;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tfloat dx = 1.0 / screenWidth;\n\tfloat dy = 1.0 / screenHeight;\n\n\tvec3 color = vec3(0.0, 0.0, 0.0);\n\tcolor += texture2D(map, vUv + vec2(-dx, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(-dx,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(-dx,  dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0,  dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx,  dy)).rgb;\n    \n\tcolor = color / 9.0;\n\t\n\tgl_FragColor = vec4(color, 1.0);\n\t\n\t\n}"},function(t,e,n){"use strict";n.r(e),e.default="precision highp float;\nprecision highp int;\n\n#define max_clip_boxes 30\n\nattribute vec3 position;\nattribute vec3 color;\nattribute vec3 normal;\nattribute float intensity;\nattribute float classification;\nattribute float returnNumber;\nattribute float numberOfReturns;\nattribute float pointSourceID;\nattribute vec4 indices;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\nuniform float pcIndex;\n\nuniform float screenWidth;\nuniform float screenHeight;\nuniform float fov;\nuniform float spacing;\n\n#if defined use_clip_box\n\tuniform mat4 clipBoxes[max_clip_boxes];\n#endif\n\nuniform float heightMin;\nuniform float heightMax;\nuniform float size; // pixel size factor\nuniform float minSize; // minimum pixel size\nuniform float maxSize; // maximum pixel size\nuniform float octreeSize;\nuniform vec3 bbSize;\nuniform vec3 uColor;\nuniform float opacity;\nuniform float clipBoxCount;\nuniform float level;\nuniform float vnStart;\nuniform bool isLeafNode;\n\nuniform float filterByNormalThreshold;\nuniform vec2 intensityRange;\nuniform float opacityAttenuation;\nuniform float intensityGamma;\nuniform float intensityContrast;\nuniform float intensityBrightness;\nuniform float rgbGamma;\nuniform float rgbContrast;\nuniform float rgbBrightness;\nuniform float transition;\nuniform float wRGB;\nuniform float wIntensity;\nuniform float wElevation;\nuniform float wClassification;\nuniform float wReturnNumber;\nuniform float wSourceID;\n\nuniform sampler2D visibleNodes;\nuniform sampler2D gradient;\nuniform sampler2D classificationLUT;\nuniform sampler2D depthMap;\n\nvarying vec3 vColor;\n\n#if !defined(color_type_point_index)\n\tvarying float vOpacity;\n#endif\n\n#if defined(weighted_splats)\n\tvarying float vLinearDepth;\n#endif\n\n#if !defined(paraboloid_point_shape) && defined(use_edl)\n\tvarying float vLogDepth;\n#endif\n\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\n\tvarying vec3 vViewPosition;\n#endif\n\n#if defined(weighted_splats) || defined(paraboloid_point_shape)\n\tvarying float vRadius;\n#endif\n\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\n\tvarying vec3 vNormal;\n#endif\n\n\n// ---------------------\n// OCTREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_octree)\n\n/**\n * Rounds the specified number to the closest integer.\n */\nfloat round(float number){\n\treturn floor(number + 0.5);\n}\n\n/**\n * Gets the number of 1-bits up to inclusive index position.\n * \n * number is treated as if it were an integer in the range 0-255\n */\nint numberOfOnes(int number, int index) {\n\tint numOnes = 0;\n\tint tmp = 128;\n\tfor (int i = 7; i >= 0; i--) {\n\n\t\tif (number >= tmp) {\n\t\t\tnumber = number - tmp;\n\n\t\t\tif (i <= index) {\n\t\t\t\tnumOnes++;\n\t\t\t}\n\t\t}\n\n\t\ttmp = tmp / 2;\n\t}\n\n\treturn numOnes;\n}\n\n/**\n * Checks whether the bit at index is 1.0\n *\n * number is treated as if it were an integer in the range 0-255\n */\nbool isBitSet(int number, int index){\n\n\t// weird multi else if due to lack of proper array, int and bitwise support in WebGL 1.0\n\tint powi = 1;\n\tif (index == 0) {\n\t\tpowi = 1;\n\t} else if (index == 1) {\n\t\tpowi = 2;\n\t} else if (index == 2) {\n\t\tpowi = 4;\n\t} else if (index == 3) {\n\t\tpowi = 8;\n\t} else if (index == 4) {\n\t\tpowi = 16;\n\t} else if (index == 5) {\n\t\tpowi = 32;\n\t} else if (index == 6) {\n\t\tpowi = 64;\n\t} else if (index == 7) {\n\t\tpowi = 128;\n\t}\n\n\tint ndp = number / powi;\n\n\treturn mod(float(ndp), 2.0) != 0.0;\n}\n\n/**\n * Gets the the LOD at the point position.\n */\nfloat getLOD() {\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tint iOffset = int(vnStart);\n\tfloat depth = level;\n\n\tfor (float i = 0.0; i <= 30.0; i++) {\n\t\tfloat nodeSizeAtLevel = octreeSize  / pow(2.0, i + level + 0.0);\n\t\t\n\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\tindex3d = floor(index3d + 0.5);\n\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\n\t\t\n\t\tvec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\n\t\tint mask = int(round(value.r * 255.0));\n\n\t\tif (isBitSet(mask, index)) {\n\t\t\t// there are more visible child nodes at this position\n\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\n\t\t\tint advanceB = int(round(value.b * 255.0));\n\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\n\t\t\tint advance = advanceG + advanceB + advanceChild;\n\n\t\t\tiOffset = iOffset + advance;\n\n\t\t\tdepth++;\n\t\t} else {\n\t\t\treturn value.a * 255.0; // no more visible child nodes at this position\n\t\t}\n\t\t\n\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;  \n\t}\n\t\t\n\treturn depth;\n}\n\nfloat getPointSizeAttenuation() {\n\treturn 0.5 * pow(2.0, getLOD());\n}\n\n#endif\n\n// ---------------------\n// KD-TREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_kdtree)\n\nfloat getLOD() {\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tfloat intOffset = 0.0;\n\tfloat depth = 0.0;\n\t\t\t\n\tvec3 size = bbSize;\t\n\tvec3 pos = position;\n\t\t\n\tfor (float i = 0.0; i <= 1000.0; i++) {\n\t\t\n\t\tvec4 value = texture2D(visibleNodes, vec2(intOffset / 2048.0, 0.0));\n\t\t\n\t\tint children = int(value.r * 255.0);\n\t\tfloat next = value.g * 255.0;\n\t\tint split = int(value.b * 255.0);\n\t\t\n\t\tif (next == 0.0) {\n\t\t \treturn depth;\n\t\t}\n\t\t\n\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);\n\t\tif (split == 1) {\n\t\t\tsplitv.x = 1.0;\n\t\t} else if (split == 2) {\n\t\t \tsplitv.y = 1.0;\n\t\t} else if (split == 4) {\n\t\t \tsplitv.z = 1.0;\n\t\t}\n\t\t\n\t\tintOffset = intOffset + next;\n\t\t\n\t\tfloat factor = length(pos * splitv / size);\n\t\tif (factor < 0.5) {\n\t\t \t// left\n\t\t\tif (children == 0 || children == 2) {\n\t\t\t\treturn depth;\n\t\t\t}\n\t\t} else {\n\t\t\t// right\n\t\t\tpos = pos - size * splitv * 0.5;\n\t\t\tif (children == 0 || children == 1) {\n\t\t\t\treturn depth;\n\t\t\t}\n\t\t\tif (children == 3) {\n\t\t\t\tintOffset = intOffset + 1.0;\n\t\t\t}\n\t\t}\n\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);\n\t\t\n\t\tdepth++;\n\t}\n\t\t\n\t\t\n\treturn depth;\t\n}\n\nfloat getPointSizeAttenuation() {\n\treturn 0.5 * pow(1.3, getLOD());\n}\n\n#endif\n\n// formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/\nfloat getContrastFactor(float contrast) {\n\treturn (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);\n}\n\nvec3 getRGB() {\n\t#if defined(use_rgb_gamma_contrast_brightness)\n\t  vec3 rgb = color;\n\t\trgb = pow(rgb, vec3(rgbGamma));\n\t\trgb = rgb + rgbBrightness;\n\t\trgb = (rgb - 0.5) * getContrastFactor(rgbContrast) + 0.5;\n\t\trgb = clamp(rgb, 0.0, 1.0);\n\t\treturn rgb;\n\t#else\n\t\treturn color;\n\t#endif\n}\n\nfloat getIntensity() {\n\tfloat w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);\n\tw = pow(w, intensityGamma);\n\tw = w + intensityBrightness;\n\tw = (w - 0.5) * getContrastFactor(intensityContrast) + 0.5;\n\tw = clamp(w, 0.0, 1.0);\n\t\n\treturn w;\n}\n\nvec3 getElevation() {\n\tvec4 world = modelMatrix * vec4( position, 1.0 );\n\tfloat w = (world.z - heightMin) / (heightMax-heightMin);\n\tvec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t\n\treturn cElevation;\n}\n\nvec4 getClassification() {\n\tvec2 uv = vec2(classification / 255.0, 0.5);\n\tvec4 classColor = texture2D(classificationLUT, uv);\n\t\n\treturn classColor;\n}\n\nvec3 getReturnNumber() {\n\tif (numberOfReturns == 1.0) {\n\t\treturn vec3(1.0, 1.0, 0.0);\n\t} else {\n\t\tif (returnNumber == 1.0) {\n\t\t\treturn vec3(1.0, 0.0, 0.0);\n\t\t} else if (returnNumber == numberOfReturns) {\n\t\t\treturn vec3(0.0, 0.0, 1.0);\n\t\t} else {\n\t\t\treturn vec3(0.0, 1.0, 0.0);\n\t\t}\n\t}\n}\n\nvec3 getSourceID() {\n\tfloat w = mod(pointSourceID, 10.0) / 10.0;\n\treturn texture2D(gradient, vec2(w, 1.0 - w)).rgb;\n}\n\nvec3 getCompositeColor() {\n\tvec3 c;\n\tfloat w;\n\n\tc += wRGB * getRGB();\n\tw += wRGB;\n\t\n\tc += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);\n\tw += wIntensity;\n\t\n\tc += wElevation * getElevation();\n\tw += wElevation;\n\t\n\tc += wReturnNumber * getReturnNumber();\n\tw += wReturnNumber;\n\t\n\tc += wSourceID * getSourceID();\n\tw += wSourceID;\n\t\n\tvec4 cl = wClassification * getClassification();\n\tc += cl.a * cl.rgb;\n\tw += wClassification * cl.a;\n\n\tc = c / w;\n\t\n\tif (w == 0.0) {\n\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t}\n\t\n\treturn c;\n}\n\nvoid main() {\n\tvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\n\t\tvViewPosition = mvPosition.xyz;\n\t#endif\n\n\t#if defined weighted_splats\n\t\tvLinearDepth = gl_Position.w;\n\t#endif\n\n\t#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\n\t\tvNormal = normalize(normalMatrix * normal);\n\t#endif\n\n\t#if !defined(paraboloid_point_shape) && defined(use_edl)\n\t\tvLogDepth = log2(-mvPosition.z);\n\t#endif\n\n\t// ---------------------\n\t// POINT SIZE\n\t// ---------------------\n\n\tfloat pointSize = 1.0;\n\tfloat slope = tan(fov / 2.0);\n\tfloat projFactor =  -0.5 * screenHeight / (slope * mvPosition.z);\n\n\t#if defined fixed_point_size\n\t\tpointSize = size;\n\t#elif defined attenuated_point_size\n\t\tpointSize = size * spacing * projFactor;\n\t#elif defined adaptive_point_size\n\t\tfloat worldSpaceSize = 2.0 * size * spacing / getPointSizeAttenuation();\n\t\tpointSize = worldSpaceSize * projFactor;\n\t#endif\n\n\tpointSize = max(minSize, pointSize);\n\tpointSize = min(maxSize, pointSize);\n\n\t#if defined(weighted_splats) || defined(paraboloid_point_shape)\n\t\tvRadius = pointSize / projFactor;\n\t#endif\n\t\n\tgl_PointSize = pointSize;\n\n\t// ---------------------\n\t// OPACITY\n\t// ---------------------\n\n\t#ifndef color_type_point_index\n\t\t#ifdef attenuated_opacity\n\t\t\tvOpacity = opacity * exp(-length(-mvPosition.xyz) / opacityAttenuation);\n\t\t#else\n\t\t\tvOpacity = opacity;\n\t\t#endif\n\t#endif\n\n\t// ---------------------\n\t// FILTERING\n\t// ---------------------\n\n\t#ifdef use_filter_by_normal\n\t\tif(abs((modelViewMatrix * vec4(normal, 0.0)).z) > filterByNormalThreshold) {\n\t\t\t// Move point outside clip space space to discard it.\n\t\t\tgl_Position = vec4(0.0, 0.0, 2.0, 1.0);\n\t\t}\n\t#endif\n\n\t// ---------------------\n\t// POINT COLOR\n\t// ---------------------\t\n\n\t#ifdef color_type_rgb\n\t\tvColor = getRGB();\n\t#elif defined color_type_height\n\t\tvColor = getElevation();\n\t#elif defined color_type_rgb_height\n\t\tvec3 cHeight = getElevation();\n\t\tvColor = (1.0 - transition) * getRGB() + transition * cHeight;\n\t#elif defined color_type_depth\n\t\tfloat linearDepth = -mvPosition.z ;\n\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;\n\t\tvColor = vec3(linearDepth, expDepth, 0.0);\n\t#elif defined color_type_intensity\n\t\tfloat w = getIntensity();\n\t\tvColor = vec3(w, w, w);\n\t#elif defined color_type_intensity_gradient\n\t\tfloat w = getIntensity();\n\t\tvColor = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\n\t#elif defined color_type_color\n\t\tvColor = uColor;\n\t#elif defined color_type_lod\n\tfloat w = getLOD() / 10.0;\n\tvColor = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\n\t#elif defined color_type_point_index\n\t\tvColor = indices.rgb;\n\t#elif defined color_type_classification\n\t  vec4 cl = getClassification(); \n\t\tvColor = cl.rgb;\n\t#elif defined color_type_return_number\n\t\tvColor = getReturnNumber();\n\t#elif defined color_type_source\n\t\tvColor = getSourceID();\n\t#elif defined color_type_normal\n\t\tvColor = (modelMatrix * vec4(normal, 0.0)).xyz;\n\t#elif defined color_type_phong\n\t\tvColor = color;\n\t#elif defined color_type_composite\n\t\tvColor = getCompositeColor();\n\t#endif\n\t\n\t#if !defined color_type_composite && defined color_type_classification\n\t\tif (cl.a == 0.0) {\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t\t\treturn;\n\t\t}\n\t#endif\n\n\t// ---------------------\n\t// CLIPPING\n\t// ---------------------\n\n\t#if defined use_clip_box\n\t\tbool insideAny = false;\n\t\tfor (int i = 0; i < max_clip_boxes; i++) {\n\t\t\tif (i == int(clipBoxCount)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\n\t\t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4(position, 1.0);\n\t\t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;\n\t\t\tinsideAny = insideAny || inside;\n\t\t}\n\n\t\tif (!insideAny) {\n\t\t\t#if defined clip_outside\n\t\t\t\tgl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);\n\t\t\t#elif defined clip_highlight_inside && !defined(color_type_depth)\n\t\t\t\tfloat c = (vColor.r + vColor.g + vColor.b) / 6.0;\n\t\t\t#endif\n\t\t} else {\n\t\t\t#if defined clip_highlight_inside\n\t\t\t\tvColor.r += 0.5;\n\t\t\t#endif\n\t\t}\n\t#endif\n}"},function(t,e,n){"use strict";n.r(e),e.default="precision highp float;\nprecision highp int;\n\n#if defined paraboloid_point_shape\n\t#extension GL_EXT_frag_depth : enable\n#endif\n\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nuniform mat4 projectionMatrix;\nuniform float opacity;\n\nuniform float blendHardness;\nuniform float blendDepthSupplement;\nuniform float fov;\nuniform float spacing;\nuniform float pcIndex;\nuniform float screenWidth;\nuniform float screenHeight;\n\nuniform sampler2D depthMap;\n\nvarying vec3 vColor;\n\n#if !defined(color_type_point_index)\n\tvarying float vOpacity;\n#endif\n\n#if defined(weighted_splats)\n\tvarying float vLinearDepth;\n#endif\n\n#if !defined(paraboloid_point_shape) && defined(use_edl)\n\tvarying float vLogDepth;\n#endif\n\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\n\tvarying vec3 vViewPosition;\n#endif\n\n#if defined(weighted_splats) || defined(paraboloid_point_shape)\n\tvarying float vRadius;\n#endif\n\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\n\tvarying vec3 vNormal;\n#endif\n\nfloat specularStrength = 1.0;\n\nvoid main() {\n\tvec3 color = vColor;\n\tfloat depth = gl_FragCoord.z;\n\n\t#if defined(circle_point_shape) || defined(paraboloid_point_shape) || defined (weighted_splats)\n\t\tfloat u = 2.0 * gl_PointCoord.x - 1.0;\n\t\tfloat v = 2.0 * gl_PointCoord.y - 1.0;\n\t#endif\n\t\n\t#if defined(circle_point_shape) || defined (weighted_splats)\n\t\tfloat cc = u*u + v*v;\n\t\tif(cc > 1.0){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n\t\n\t#if defined weighted_splats\n\t\tvec2 uv = gl_FragCoord.xy / vec2(screenWidth, screenHeight);\n\t\tfloat sDepth = texture2D(depthMap, uv).r;\n\t\tif(vLinearDepth > sDepth + vRadius + blendDepthSupplement){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n\t\t\n\t#if defined color_type_point_index\n\t\tgl_FragColor = vec4(color, pcIndex / 255.0);\n\t#else\n\t\tgl_FragColor = vec4(color, vOpacity);\n\t#endif\n\n\t#if defined(color_type_phong)\n\t\t#if MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0\n\t\t\tvec3 normal = normalize( vNormal );\n\t\t\tnormal.z = abs(normal.z);\n\n\t\t\tvec3 viewPosition = normalize( vViewPosition );\n\t\t#endif\n\n\t\t// code taken from three.js phong light fragment shader\n\t\n\t\t#if MAX_POINT_LIGHTS > 0\n\n\t\t\tvec3 pointDiffuse = vec3( 0.0 );\n\t\t\tvec3 pointSpecular = vec3( 0.0 );\n\n\t\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\t\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\t\t\tfloat lDistance = 1.0;\n\t\t\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\t\t\tlVector = normalize( lVector );\n\n\t\t\t\t\t\t// diffuse\n\n\t\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t\t#else\n\n\t\t\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t\t#endif\n\n\t\t\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n\t\t\t\t// specular\n\n\t\t\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\t\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\t\t\t\tpointSpecular = vec3(0.0, 0.0, 0.0);\n\t\t\t}\n\t\t\n\t\t#endif\n\t\t\n\t\t#if MAX_DIR_LIGHTS > 0\n\n\t\t\tvec3 dirDiffuse = vec3( 0.0 );\n\t\t\tvec3 dirSpecular = vec3( 0.0 );\n\n\t\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\t\t\tvec3 dirVector = normalize( lDirection.xyz );\n\n\t\t\t\t\t\t// diffuse\n\n\t\t\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t\t#else\n\n\t\t\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t\t#endif\n\n\t\t\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t\t\t// specular\n\n\t\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\t\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\t\t\t}\n\n\t\t#endif\n\t\t\n\t\tvec3 totalDiffuse = vec3( 0.0 );\n\t\tvec3 totalSpecular = vec3( 0.0 );\n\t\t\n\t\t#if MAX_POINT_LIGHTS > 0\n\n\t\t\ttotalDiffuse += pointDiffuse;\n\t\t\ttotalSpecular += pointSpecular;\n\n\t\t#endif\n\t\t\n\t\t#if MAX_DIR_LIGHTS > 0\n\n\t\t\ttotalDiffuse += dirDiffuse;\n\t\t\ttotalSpecular += dirSpecular;\n\n\t\t#endif\n\t\t\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n\t#endif\n\t\n\t#if defined weighted_splats\n\t    //float w = pow(1.0 - (u*u + v*v), blendHardness);\n\t\t\n\t\tfloat wx = 2.0 * length(2.0 * gl_PointCoord - 1.0);\n\t\tfloat w = exp(-wx * wx * 0.5);\n\t\t\n\t\t//float distance = length(2.0 * gl_PointCoord - 1.0);\n\t\t//float w = exp( -(distance * distance) / blendHardness);\n\t\t\n\t\tgl_FragColor.rgb = gl_FragColor.rgb * w;\n\t\tgl_FragColor.a = w;\n\t#endif\n\t\n\t#if defined paraboloid_point_shape\n\t\tfloat wi = 0.0 - ( u*u + v*v);\n\t\tvec4 pos = vec4(vViewPosition, 1.0);\n\t\tpos.z += wi * vRadius;\n\t\tfloat linearDepth = -pos.z;\n\t\tpos = projectionMatrix * pos;\n\t\tpos = pos / pos.w;\n\t\tfloat expDepth = pos.z;\n\t\tdepth = (pos.z + 1.0) / 2.0;\n\t\tgl_FragDepthEXT = depth;\n\t\t\n\t\t#if defined(color_type_depth)\n\t\t\tgl_FragColor.r = linearDepth;\n\t\t\tgl_FragColor.g = expDepth;\n\t\t#endif\n\t\t\n\t\t#if defined(use_edl)\n\t\t\tgl_FragColor.a = log2(linearDepth);\n\t\t#endif\n\t\t\n\t#else\n\t\t#if defined(use_edl)\n\t\t\tgl_FragColor.a = vLogDepth;\n\t\t#endif\n\t#endif\t\n}\n"},function(t,e,n){t.exports=function(){return n(33)('!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";var n=r(1);onmessage=n.handleMessage},function(t,e,r){"use strict";var n;r.r(e),r.d(e,"handleMessage",(function(){return M})),function(t){t[t.POSITION_CARTESIAN=0]="POSITION_CARTESIAN",t[t.COLOR_PACKED=1]="COLOR_PACKED",t[t.COLOR_FLOATS_1=2]="COLOR_FLOATS_1",t[t.COLOR_FLOATS_255=3]="COLOR_FLOATS_255",t[t.NORMAL_FLOATS=4]="NORMAL_FLOATS",t[t.FILLER=5]="FILLER",t[t.INTENSITY=6]="INTENSITY",t[t.CLASSIFICATION=7]="CLASSIFICATION",t[t.NORMAL_SPHEREMAPPED=8]="NORMAL_SPHEREMAPPED",t[t.NORMAL_OCT16=9]="NORMAL_OCT16",t[t.NORMAL=10]="NORMAL"}(n||(n={}));var i={ordinal:1,size:4},a={ordinal:2,size:1},o={ordinal:3,size:1},u={ordinal:5,size:2};function s(t,e,r){return{name:t,type:e,numElements:r,byteSize:r*e.size}}var f=s(n.COLOR_PACKED,a,4),A={POSITION_CARTESIAN:s(n.POSITION_CARTESIAN,i,3),RGBA_PACKED:f,COLOR_PACKED:f,RGB_PACKED:s(n.COLOR_PACKED,a,3),NORMAL_FLOATS:s(n.NORMAL_FLOATS,i,3),FILLER_1B:s(n.FILLER,o,1),INTENSITY:s(n.INTENSITY,u,1),CLASSIFICATION:s(n.CLASSIFICATION,o,1),NORMAL_SPHEREMAPPED:s(n.NORMAL_SPHEREMAPPED,o,2),NORMAL_OCT16:s(n.NORMAL_OCT16,o,2),NORMAL:s(n.NORMAL,i,3)};!function(){function t(t){void 0===t&&(t=[]),this.attributes=[],this.byteSize=0,this.size=0;for(var e=0;e<t.length;e++){var r=t[e],n=A[r];this.attributes.push(n),this.byteSize+=n.byteSize,this.size++}}t.prototype.add=function(t){this.attributes.push(t),this.byteSize+=t.byteSize,this.size++},t.prototype.hasColors=function(){return void 0!==this.attributes.find(O)},t.prototype.hasNormals=function(){return void 0!==this.attributes.find(b)}}();function O(t){return t.name===n.COLOR_PACKED}function b(t){var e=t.name;return e===n.NORMAL_SPHEREMAPPED||e===n.NORMAL_FLOATS||e===n.NORMAL||e===n.NORMAL_OCT16}var c=function(){function t(t){this.versionMinor=0,this.version=t;var e=-1===t.indexOf(".")?t.length:t.indexOf(".");this.versionMajor=parseInt(t.substr(0,e),10),this.versionMinor=parseInt(t.substr(e+1),10),isNaN(this.versionMinor)&&(this.versionMinor=0)}return t.prototype.newerThan=function(e){var r=new t(e);return this.versionMajor>r.versionMajor||this.versionMajor===r.versionMajor&&this.versionMinor>r.versionMinor},t.prototype.equalOrHigher=function(e){var r=new t(e);return this.versionMajor>r.versionMajor||this.versionMajor===r.versionMajor&&this.versionMinor>=r.versionMinor},t.prototype.upTo=function(t){return!this.newerThan(t)},t}(),h=function(){function t(t){this.tmp=new ArrayBuffer(4),this.tmpf=new Float32Array(this.tmp),this.tmpu8=new Uint8Array(this.tmp),this.u8=new Uint8Array(t)}return t.prototype.getUint32=function(t){return this.u8[t+3]<<24|this.u8[t+2]<<16|this.u8[t+1]<<8|this.u8[t]},t.prototype.getUint16=function(t){return this.u8[t+1]<<8|this.u8[t]},t.prototype.getFloat32=function(t){var e=this.tmpu8,r=this.u8,n=this.tmpf;return e[0]=r[t+0],e[1]=r[t+1],e[2]=r[t+2],e[3]=r[t+3],n[0]},t.prototype.getUint8=function(t){return this.u8[t]},t}(),I=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1};function M(t){for(var e=t.data.buffer,r=t.data.pointAttributes,i={attributeBuffers:{},currentOffset:0,data:new h(e),mean:[0,0,0],nodeOffset:t.data.offset,numPoints:t.data.buffer.byteLength/r.byteSize,pointAttributes:r,scale:t.data.scale,tightBoxMax:[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],tightBoxMin:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],transferables:[],version:new c(t.data.version)},a=0,o=i.pointAttributes.attributes;a<o.length;a++){var u=o[a];S(u,i),i.currentOffset+=u.byteSize}for(var s=new ArrayBuffer(4*i.numPoints),f=new Uint32Array(s),O=0;O<i.numPoints;O++)f[O]=O;i.attributeBuffers[n.CLASSIFICATION]||function(t){for(var e=new ArrayBuffer(4*t.numPoints),r=new Float32Array(e),i=0;i<t.numPoints;i++)r[i]=0;t.attributeBuffers[n.CLASSIFICATION]={buffer:e,attribute:A.CLASSIFICATION}}(i);var b={buffer:e,mean:i.mean,attributeBuffers:i.attributeBuffers,tightBoundingBox:{min:i.tightBoxMin,max:i.tightBoxMax},indices:s};postMessage(b,i.transferables)}function S(t,e){var r=function(t,e){switch(t.name){case n.POSITION_CARTESIAN:return function(t,e){for(var r=new ArrayBuffer(4*e.numPoints*3),n=new Float32Array(r),i=0;i<e.numPoints;i++){var a=void 0,o=void 0,u=void 0;e.version.newerThan("1.3")?(a=e.data.getUint32(e.currentOffset+i*e.pointAttributes.byteSize+0)*e.scale,o=e.data.getUint32(e.currentOffset+i*e.pointAttributes.byteSize+4)*e.scale,u=e.data.getUint32(e.currentOffset+i*e.pointAttributes.byteSize+8)*e.scale):(a=e.data.getFloat32(i*e.pointAttributes.byteSize+0)+e.nodeOffset[0],o=e.data.getFloat32(i*e.pointAttributes.byteSize+4)+e.nodeOffset[1],u=e.data.getFloat32(i*e.pointAttributes.byteSize+8)+e.nodeOffset[2]),n[3*i+0]=a,n[3*i+1]=o,n[3*i+2]=u,e.mean[0]+=a/e.numPoints,e.mean[1]+=o/e.numPoints,e.mean[2]+=u/e.numPoints,e.tightBoxMin[0]=Math.min(e.tightBoxMin[0],a),e.tightBoxMin[1]=Math.min(e.tightBoxMin[1],o),e.tightBoxMin[2]=Math.min(e.tightBoxMin[2],u),e.tightBoxMax[0]=Math.max(e.tightBoxMax[0],a),e.tightBoxMax[1]=Math.max(e.tightBoxMax[1],o),e.tightBoxMax[2]=Math.max(e.tightBoxMax[2],u)}return{buffer:r,attribute:t}}(t,e);case n.COLOR_PACKED:return function(t,e){for(var r=new ArrayBuffer(3*e.numPoints),n=new Uint8Array(r),i=0;i<e.numPoints;i++)n[3*i+0]=e.data.getUint8(e.currentOffset+i*e.pointAttributes.byteSize+0),n[3*i+1]=e.data.getUint8(e.currentOffset+i*e.pointAttributes.byteSize+1),n[3*i+2]=e.data.getUint8(e.currentOffset+i*e.pointAttributes.byteSize+2);return{buffer:r,attribute:t}}(t,e);case n.INTENSITY:return function(t,e){for(var r=new ArrayBuffer(4*e.numPoints),n=new Float32Array(r),i=0;i<e.numPoints;i++)n[i]=e.data.getUint16(e.currentOffset+i*e.pointAttributes.byteSize);return{buffer:r,attribute:t}}(t,e);case n.CLASSIFICATION:return function(t,e){for(var r=new ArrayBuffer(e.numPoints),n=new Uint8Array(r),i=0;i<e.numPoints;i++)n[i]=e.data.getUint8(e.currentOffset+i*e.pointAttributes.byteSize);return{buffer:r,attribute:t}}(t,e);case n.NORMAL_SPHEREMAPPED:return function(t,e){for(var r=new ArrayBuffer(4*e.numPoints*3),n=new Float32Array(r),i=0;i<e.numPoints;i++){var a=e.data.getUint8(e.currentOffset+i*e.pointAttributes.byteSize+0),o=e.data.getUint8(e.currentOffset+i*e.pointAttributes.byteSize+1),u=2*(a/255)-1,s=2*(o/255)-1,f=1,A=u*-u+s*-s+1*f;f=A,u*=Math.sqrt(A),s*=Math.sqrt(A),u*=2,s*=2,f=2*f-1,n[3*i+0]=u,n[3*i+1]=s,n[3*i+2]=f}return{buffer:r,attribute:t}}(t,e);case n.NORMAL_OCT16:return function(t,e){for(var r=new ArrayBuffer(4*e.numPoints*3),n=new Float32Array(r),i=0;i<e.numPoints;i++){var a=e.data.getUint8(e.currentOffset+i*e.pointAttributes.byteSize+0),o=e.data.getUint8(e.currentOffset+i*e.pointAttributes.byteSize+1),u=a/255*2-1,s=o/255*2-1,f=1-Math.abs(u)-Math.abs(s),A=0,O=0;f>=0?(A=u,O=s):(A=-(s/I(s)-1)/I(u),O=-(u/I(u)-1)/I(s));var b=Math.sqrt(A*A+O*O+f*f);A/=b,O/=b,f/=b,n[3*i+0]=A,n[3*i+1]=O,n[3*i+2]=f}return{buffer:r,attribute:t}}(t,e);case n.NORMAL:return function(t,e){for(var r=new ArrayBuffer(4*e.numPoints*3),n=new Float32Array(r),i=0;i<e.numPoints;i++){var a=e.data.getFloat32(e.currentOffset+i*e.pointAttributes.byteSize+0),o=e.data.getFloat32(e.currentOffset+i*e.pointAttributes.byteSize+4),u=e.data.getFloat32(e.currentOffset+i*e.pointAttributes.byteSize+8);n[3*i+0]=a,n[3*i+1]=o,n[3*i+2]=u}return{buffer:r,attribute:t}}(t,e);default:return}}(t,e);void 0!==r&&(e.attributeBuffers[r.attribute.name]=r,e.transferables.push(r.buffer))}}]);',null)}},function(t,e,n){"use strict";var i=window.URL||window.webkitURL;t.exports=function(t,e){try{try{var n;try{(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),n=n.getBlob()}catch(e){n=new Blob([t])}return new Worker(i.createObjectURL(n))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(t){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}}])}));